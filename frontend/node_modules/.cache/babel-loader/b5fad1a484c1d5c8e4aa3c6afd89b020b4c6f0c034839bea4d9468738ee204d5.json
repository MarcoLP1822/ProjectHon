{"ast":null,"code":"var _jsxFileName = \"/Users/marcolp/AI/CURSOR projects/Lose/frontend/src/context/BookContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useState, useEffect, createContext, useContext } from 'react';\nimport { collection, addDoc, deleteDoc, updateDoc, doc, query, onSnapshot } from 'firebase/firestore';\nimport { ref, uploadBytes, deleteObject, getDownloadURL } from 'firebase/storage';\nimport { db, storage } from '../services/firebase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BookContext = /*#__PURE__*/createContext();\nexport const BookProvider = ({\n  children\n}) => {\n  _s();\n  const [books, setBooks] = useState([]);\n  const [isUploading, setIsUploading] = useState(false);\n  useEffect(() => {\n    const q = query(collection(db, 'books'));\n    const unsubscribe = onSnapshot(q, snapshot => {\n      const booksData = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setBooks(booksData);\n    });\n    return () => unsubscribe();\n  }, []);\n  const addBook = async bookData => {\n    try {\n      setIsUploading(true);\n\n      // Create a reference to the file in Firebase Storage\n      const fileRef = ref(storage, `books/${Date.now()}-${bookData.file.name}`);\n\n      // Upload the file\n      const uploadResult = await uploadBytes(fileRef, bookData.file);\n\n      // Get the download URL\n      const downloadURL = await getDownloadURL(uploadResult.ref);\n\n      // Add metadata to Firestore\n      const docRef = await addDoc(collection(db, 'books'), {\n        title: bookData.file.name.replace(/\\.[^/.]+$/, \"\"),\n        // Remove file extension\n        originalFilename: bookData.file.name,\n        fileUrl: downloadURL,\n        filePath: fileRef.fullPath,\n        fileSize: bookData.file.size,\n        fileType: bookData.file.type,\n        date: new Date().toLocaleString('en-US', {\n          month: 'long',\n          year: 'numeric'\n        }).toUpperCase(),\n        uploadDate: new Date()\n      });\n      return docRef.id;\n    } catch (error) {\n      console.error('Error adding book:', error);\n      throw error;\n    } finally {\n      setIsUploading(false);\n    }\n  };\n  const removeBook = async bookId => {\n    try {\n      const book = books.find(b => b.id === bookId);\n      if (book !== null && book !== void 0 && book.filePath) {\n        // Delete file from Storage\n        const fileRef = ref(storage, book.filePath);\n        await deleteObject(fileRef);\n      }\n\n      // Delete metadata from Firestore\n      await deleteDoc(doc(db, 'books', bookId));\n    } catch (error) {\n      console.error('Error removing book:', error);\n      throw error;\n    }\n  };\n  const updateBook = async (bookId, updatedBook) => {\n    try {\n      const bookRef = doc(db, 'books', bookId);\n      await updateDoc(bookRef, updatedBook);\n    } catch (error) {\n      console.error('Error updating book:', error);\n      throw error;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(BookContext.Provider, {\n    value: {\n      books,\n      addBook,\n      removeBook,\n      updateBook,\n      isUploading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this);\n};\n_s(BookProvider, \"uR39dddrIpEc/AR0qX2AIYjVwVM=\");\n_c = BookProvider;\nexport const useBooks = () => {\n  _s2();\n  return useContext(BookContext);\n};\n_s2(useBooks, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"BookProvider\");","map":{"version":3,"names":["useState","useEffect","createContext","useContext","collection","addDoc","deleteDoc","updateDoc","doc","query","onSnapshot","ref","uploadBytes","deleteObject","getDownloadURL","db","storage","jsxDEV","_jsxDEV","BookContext","BookProvider","children","_s","books","setBooks","isUploading","setIsUploading","q","unsubscribe","snapshot","booksData","docs","map","id","data","addBook","bookData","fileRef","Date","now","file","name","uploadResult","downloadURL","docRef","title","replace","originalFilename","fileUrl","filePath","fullPath","fileSize","size","fileType","type","date","toLocaleString","month","year","toUpperCase","uploadDate","error","console","removeBook","bookId","book","find","b","updateBook","updatedBook","bookRef","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useBooks","_s2","$RefreshReg$"],"sources":["/Users/marcolp/AI/CURSOR projects/Lose/frontend/src/context/BookContext.js"],"sourcesContent":["import { useState, useEffect, createContext, useContext } from 'react';\nimport { \n  collection, \n  addDoc, \n  deleteDoc, \n  updateDoc,\n  doc, \n  query,\n  onSnapshot \n} from 'firebase/firestore';\nimport { \n  ref, \n  uploadBytes, \n  deleteObject, \n  getDownloadURL \n} from 'firebase/storage';\nimport { db, storage } from '../services/firebase';\n\nconst BookContext = createContext();\n\nexport const BookProvider = ({ children }) => {\n  const [books, setBooks] = useState([]);\n  const [isUploading, setIsUploading] = useState(false);\n\n  useEffect(() => {\n    const q = query(collection(db, 'books'));\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const booksData = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setBooks(booksData);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const addBook = async (bookData) => {\n    try {\n      setIsUploading(true);\n      \n      // Create a reference to the file in Firebase Storage\n      const fileRef = ref(storage, `books/${Date.now()}-${bookData.file.name}`);\n      \n      // Upload the file\n      const uploadResult = await uploadBytes(fileRef, bookData.file);\n      \n      // Get the download URL\n      const downloadURL = await getDownloadURL(uploadResult.ref);\n\n      // Add metadata to Firestore\n      const docRef = await addDoc(collection(db, 'books'), {\n        title: bookData.file.name.replace(/\\.[^/.]+$/, \"\"), // Remove file extension\n        originalFilename: bookData.file.name,\n        fileUrl: downloadURL,\n        filePath: fileRef.fullPath,\n        fileSize: bookData.file.size,\n        fileType: bookData.file.type,\n        date: new Date().toLocaleString('en-US', { \n          month: 'long', \n          year: 'numeric' \n        }).toUpperCase(),\n        uploadDate: new Date()\n      });\n\n      return docRef.id;\n    } catch (error) {\n      console.error('Error adding book:', error);\n      throw error;\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const removeBook = async (bookId) => {\n    try {\n      const book = books.find(b => b.id === bookId);\n      \n      if (book?.filePath) {\n        // Delete file from Storage\n        const fileRef = ref(storage, book.filePath);\n        await deleteObject(fileRef);\n      }\n\n      // Delete metadata from Firestore\n      await deleteDoc(doc(db, 'books', bookId));\n    } catch (error) {\n      console.error('Error removing book:', error);\n      throw error;\n    }\n  };\n\n  const updateBook = async (bookId, updatedBook) => {\n    try {\n      const bookRef = doc(db, 'books', bookId);\n      await updateDoc(bookRef, updatedBook);\n    } catch (error) {\n      console.error('Error updating book:', error);\n      throw error;\n    }\n  };\n\n  return (\n    <BookContext.Provider value={{ \n      books, \n      addBook, \n      removeBook, \n      updateBook,\n      isUploading \n    }}>\n      {children}\n    </BookContext.Provider>\n  );\n};\n\nexport const useBooks = () => useContext(BookContext); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}