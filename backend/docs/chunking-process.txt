PROCESSO DI CHUNKING DEI LIBRI

1. FLUSSO DI ELABORAZIONE
-------------------------------------------------------------------------------
Upload File -> Estrazione Testo -> Identificazione Struttura -> Creazione Chunks -> Rolling Summary

2. IDENTIFICAZIONE STRUTTURA
-------------------------------------------------------------------------------
- Ricerca capitoli usando pattern standard (es. "Capitolo 1", "Chapter 1")
- Identificazione sezioni (§, "Sezione", ecc.)
- Conteggio paragrafi
- Metadata sulla struttura salvati nel documento

3. CREAZIONE CHUNKS
-------------------------------------------------------------------------------
Priorità di chunking:
1. Per capitoli (se presenti)
   - Ogni capitolo diventa un chunk
   - Capitoli troppo lunghi vengono suddivisi ulteriormente

2. Per sezioni (se non ci sono capitoli)
   - Ogni sezione diventa un chunk
   - Sezioni troppo lunghe vengono suddivise

3. Per tokens (fallback)
   - Dimensione chunk: 6000 tokens
   - Overlap: 500 tokens
   - Rispetto dei confini naturali del testo

4. ROLLING SUMMARY
-------------------------------------------------------------------------------
- Processo iterativo di summarization
- Mantiene il contesto tra i chunks
- Aggiorna progressivamente il summary
- Utilizzato per tutte le generazioni AI

5. LIMITI E CONFIGURAZIONE
-------------------------------------------------------------------------------
TOKEN_LIMIT: 8000 tokens
MIN_TOKENS_PER_CHUNK: 1000 tokens
OVERLAP_TOKENS: 500 tokens
MAX_SUMMARY_LENGTH: 2000 tokens

6. GESTIONE ERRORI
-------------------------------------------------------------------------------
- Validazione chunks
- Retry per fallimenti AI
- Logging dettagliato
- Gestione edge cases (libri molto corti/lunghi)

7. STORAGE E PERFORMANCE
-------------------------------------------------------------------------------
- Chunks salvati nel documento MongoDB
- Caching dei risultati intermedi
- Gestione efficiente della memoria
- Pulizia automatica della cache

8. COMPATIBILITÀ
-------------------------------------------------------------------------------
- Supporto per documenti esistenti
- Migrazione graduale
- Fallback per documenti senza chunks 